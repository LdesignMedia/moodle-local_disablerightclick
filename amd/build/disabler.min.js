/**
 * Javascript controller for disabling features like right click
 *
 * @module     local_disablerightclick/disabler
 * @package    local_disablerightclick
 * @copyright  2019 Yogesh Shirsath <yogshirsath@hotmail.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      1.0
 */
define("local_disablerightclick/disabler",["jquery","core/ajax","core/notification","core/modal_factory","core/modal_events","core/templates"],(function($,Ajax,Notification,ModalFactory,ModalEvents,Templates){return{init:function(){var devtools={isOpen:!1,orientation:void 0},strings=[],wholebody=null,wholehead=null,PROMISSES_SETTINGS=function(contextid){return Ajax.call([{methodname:"local_disablerightclick_settings",args:{contextid:contextid}}])[0]},PROMISSES_SUPPORT=function(action){return Ajax.call([{methodname:"local_disablerightclick_support",args:{action:action}}])[0]};function showToaster(msg,duration){null==duration&&(duration=2e3);var toast=$("<div class='disabler-toaster toaster-container'><lable class='toaster-message'>"+msg+"</lable></div>");$("html").append(toast),$(toast).addClass("show"),setTimeout((function(){$(toast).addClass("fade"),setTimeout((function(){$(toast).removeClass("fade"),setTimeout((function(){$(toast).remove()}),300)}),duration)}))}function devToolsToggled(isOpen){1==isOpen&&(console.clear(),wholebody=$("body").detach(),$("head")&&(wholehead=$("head").detach()),0==$("#body-detached-css").length&&$("html").append($('<style id="body-detached-css">.disabler-toaster.toaster-container {position: fixed;width: 100%;top: 1vw;z-index: 140002;left: 0;opacity: 0;text-align: center;transition: top 0.3s linear, opacity 0.3s linear;display: none;}.disabler-toaster.toaster-container.fade {top: 6vw;opacity: 1;}.disabler-toaster.toaster-container.show {display: block;}.disabler-toaster.toaster-container .toaster-message {padding: 1rem 2rem;color: white;border-radius: 2px;background-color: #424242;}</style>')),showToaster(strings.developertoolsopened,5e3)),0==isOpen&&($("html").append(wholebody),wholebody=null,null!==wholehead&&$("html").append(wholehead))}function currentPage(currentUrl,allowed){var matched=!1;return(allowed=allowed.trim().split("\n")).forEach((function(url){matched||-1!=currentUrl.indexOf(url.trim())&&(matched=!0)})),matched}function disabler(root,settings){if(0!=settings.length){var url=window.location.href;if(""==settings.allowall||!currentPage(url,settings.allowall)){if(settings.disablerightclick&&1==settings.disablerightclick){if(""!=settings.allowrightclick&&currentPage(url,settings.allowrightclick))return;root.contextmenu((function(event){showToaster(strings.rightclick),event.preventDefault()}))}if(settings.disablecutcopypaste&&1==settings.disablecutcopypaste){if(""!=settings.allowcutcopypaste&&currentPage(url,settings.allowcutcopypaste))return;root.on("keydown",(function(event){if(1==event.ctrlKey&&-1!=[65,67,83,86,88].indexOf(event.keyCode))return showToaster(strings.cutcopypaste),void event.preventDefault()}))}if(settings.disabledevelopertools&&1==settings.disabledevelopertools){if(""!=settings.allowdevelopertools&&currentPage(url,settings.allowdevelopertools))return;!function(root){root.on("keydown",(function(event){if(123==event.keyCode||1==event.ctrlKey&&1==event.shiftKey&&-1!=[67,73,74].indexOf(event.keyCode)||1==event.ctrlKey&&-1!=[85].indexOf(event.keyCode))return showToaster(strings.developertools),void event.preventDefault()})),setInterval((function(){var widthThreshold=window.outerWidth-window.innerWidth>160,heightThreshold=window.outerHeight-window.innerHeight>160,orientation=widthThreshold?"vertical":"horizontal";heightThreshold&&widthThreshold||!(window.Firebug&&window.Firebug.chrome&&window.Firebug.chrome.isInitialized||widthThreshold||heightThreshold)?(devtools.isOpen&&devToolsToggled(!1),devtools.isOpen=!1,devtools.orientation=void 0):(devtools.isOpen&&devtools.orientation===orientation||devToolsToggled(!0),devtools.isOpen=!0,devtools.orientation=orientation)}),1e3)}(root)}}}}$(document).ready((function(){var contextid=0;null!=M.cfg.contextid&&(contextid=M.cfg.contextid),PROMISSES_SETTINGS(contextid).done((function(response){var showsupport,data=JSON.parse(response);strings=data.strings,disabler($("body"),data.settings),showsupport=data.showsupport,data.context,1==showsupport&&ModalFactory.create({type:ModalFactory.types.DEFAULT,title:strings.supporttitle,body:Templates.render("local_disablerightclick/support_modal",{})},$("#create-modal")).done((function(modal){modal.getRoot(),modal.show(),$("body").on("click","[data-action-disablerightclick]",(function(){PROMISSES_SUPPORT($(this).data("value")),modal.destroy()}))})).fail(Notification.exception),setInterval((function(){0!=$("iframe").length&&$("iframe:not(.applied-disablement)").each((function(index,iframe){$(this).addClass("applied-disablement"),disabler($(iframe.contentWindow.document.body),data.settings)}))}),1e3)})).fail(Notification.exception)}))}}}));

//# sourceMappingURL=disabler.min.js.map