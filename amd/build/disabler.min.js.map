<<<<<<< HEAD
{"version":3,"file":"disabler.min.js","sources":["../src/disabler.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript controller for disabling features like right click\n *\n * @module     local_disablerightclick/disabler\n * @package    local_disablerightclick\n * @copyright  2019 Yogesh Shirsath <yogshirsath@hotmail.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since      1.0\n */\n\ndefine([\n    'jquery',\n    'core/ajax',\n    'core/notification',\n    'core/modal_factory',\n    'core/modal_events',\n    'core/templates',\n], function(\n    $,\n    Ajax,\n    Notification,\n    ModalFactory,\n    ModalEvents,\n    Templates\n) {\n    return {\n        init: function() {\n            var devtools = {\n                isOpen: false,\n                orientation: undefined\n            };\n\n            // Threshold to check developer tools change.\n            var threshold = 160;\n\n            // Store strings.\n            var strings = [];\n\n            // Store whole body.\n            var wholebody = null;\n\n            // Store whole head.\n            var wholehead = null;\n\n            // Promisses.\n            var PROMISSES = {\n                SETTINGS: function(contextid) {\n                    return Ajax.call([{\n                        methodname: \"local_disablerightclick_settings\",\n                        args: {\n                            contextid: contextid\n                        }\n                    }])[0];\n                },\n                SUPPORT: function(action) {\n                    return Ajax.call([{\n                        methodname: \"local_disablerightclick_support\",\n                        args: {\n                            action: action\n                        }\n                    }])[0];\n                }\n            };\n\n            /**\n             * Show toaster with message\n             *\n             * @param {String}  msg      Toaster message\n             * @param {Integer} duration Duration of toaster\n             */\n            function showToaster(msg, duration) {\n                if (duration == undefined) {\n                    duration = 2000;\n                }\n                var toast = $(\"<div class='disabler-toaster toaster-container'>\" +\n                \"<lable class='toaster-message'>\" + msg + \"</lable>\" +\n                \"</div>\");\n                $('html').append(toast);\n                $(toast).addClass('show');\n                setTimeout(function() {\n                    $(toast).addClass('fade');\n                    setTimeout(function() {\n                        $(toast).removeClass('fade');\n                        setTimeout(function() {\n                            $(toast).remove();\n                        }, 300);\n                    }, duration);\n                });\n            }\n\n            /**\n             * Start interval when developer tools is opened else clear inerval\n             *\n             * @param  {Boolean} isOpen true if tools is open\n             */\n            function devToolsToggled(isOpen) {\n                if (isOpen == true) {\n                    // eslint-disable-next-line no-console\n                    console.clear();\n                    wholebody = $('body').detach();\n                    if ($('head')) {\n                        wholehead = $('head').detach();\n                    }\n                    if ($('#body-detached-css').length == 0) {\n                        $('html').append(\n                            $('<style id=\"body-detached-css\">' +\n                            '.disabler-toaster.toaster-container {' +\n                            'position: fixed;' +\n                            'width: 100%;' +\n                            'top: 1vw;' +\n                            'z-index: 140002;' +\n                            'left: 0;' +\n                            'opacity: 0;' +\n                            'text-align: center;' +\n                            'transition: top 0.3s linear, opacity 0.3s linear;' +\n                            'display: none;' +\n                            '}' +\n                            '.disabler-toaster.toaster-container.fade {' +\n                            'top: 6vw;' +\n                            'opacity: 1;' +\n                            '}' +\n                            '.disabler-toaster.toaster-container.show {' +\n                            'display: block;' +\n                            '}' +\n                            '.disabler-toaster.toaster-container .toaster-message {' +\n                            'padding: 1rem 2rem;' +\n                            'color: white;' +\n                            'border-radius: 2px;' +\n                            'background-color: #424242;' +\n                            '}' +\n                            '</style>')\n                        );\n                    }\n                    showToaster(strings.developertoolsopened, 5000);\n                }\n                if (isOpen == false) {\n                    $('html').append(wholebody);\n                    wholebody = null;\n                    if (wholehead !== null) {\n                        $('html').append(wholehead);\n                    }\n                }\n            }\n\n            /**\n             * Check whether developer tools are opened or not\n             * @param {Object} root     root element object\n             */\n            function checkDevTools(root) {\n\n                // Check key down.\n                root.on('keydown', function(event) {\n                    if (event.keyCode == 123 ||\n                        (event.ctrlKey == true && event.shiftKey == true && [67, 73, 74].indexOf(event.keyCode) != -1) ||\n                        (event.ctrlKey == true && [85].indexOf(event.keyCode) != -1)) {\n                        showToaster(strings.developertools);\n                        event.preventDefault();\n                        return;\n                    }\n                });\n\n                // Start interval to check developer tools is open or close.\n                setInterval(function() {\n                    var widthThreshold = window.outerWidth - window.innerWidth > threshold;\n                    var heightThreshold = window.outerHeight - window.innerHeight > threshold;\n                    var orientation = widthThreshold ? 'vertical' : 'horizontal';\n\n                    if (\n                        !(heightThreshold && widthThreshold) &&\n                        ((window.Firebug && window.Firebug.chrome && window.Firebug.chrome.isInitialized) ||\n                            widthThreshold ||\n                            heightThreshold)\n                    ) {\n                        if (!devtools.isOpen || devtools.orientation !== orientation) {\n                            devToolsToggled(true);\n                        }\n\n                        devtools.isOpen = true;\n                        devtools.orientation = orientation;\n                    } else {\n                        if (devtools.isOpen) {\n                            devToolsToggled(false);\n                        }\n\n                        devtools.isOpen = false;\n                        devtools.orientation = undefined;\n                    }\n                }, 1000);\n            }\n\n            /**\n             * Check if current page has url from allowed list\n             *\n             * @param  {String} currentUrl Current page url\n             * @param  {String} allowed    Allowed url list\n             * @return {Bool}              True if allowed on current page\n             */\n            function currentPage(currentUrl, allowed) {\n                var matched = false;\n                allowed = allowed.trim().split('\\n');\n                allowed.forEach(function(url) {\n                    if (matched) {\n                        return;\n                    }\n                    if (currentUrl.indexOf(url.trim()) != -1) {\n                        matched = true;\n                    }\n                });\n                return matched;\n            }\n\n            /**\n             * Disable functionality based on admin settings\n             *\n             * @param {Object} root     root element object\n             * @param {Object} settings Settings object\n             */\n            function disabler(root, settings) {\n\n                // Skip if no need to disable.\n                if (settings.length == 0) {\n                    return;\n                }\n\n                // Current page url.\n                var url = window.location.href;\n\n                // Skip disabling if all allowed in current page.\n                if (settings.allowall != '' && currentPage(url, settings.allowall)) {\n                    return;\n                }\n\n                // Disable right click.\n                if (settings.disablerightclick && settings.disablerightclick == true) {\n                    // Skip disabling if allowed in current page.\n                    if (settings.allowrightclick != '' && currentPage(url, settings.allowrightclick)) {\n                        return;\n                    }\n                    root.contextmenu(function(event) {\n                        showToaster(strings.rightclick);\n                        event.preventDefault();\n                        return;\n                    });\n                }\n\n                // Disable cut copy paste.\n                if (settings.disablecutcopypaste && settings.disablecutcopypaste == true) {\n                    // Skip disabling if allowed in current page.\n                    if (settings.allowcutcopypaste != '' && currentPage(url, settings.allowcutcopypaste)) {\n                        return;\n                    }\n                    root.on('keydown', function(event) {\n                        if (event.ctrlKey == true && [65, 67, 83, 86, 88].indexOf(event.keyCode) != -1) {\n                            showToaster(strings.cutcopypaste);\n                            event.preventDefault();\n                            return;\n                        }\n                    });\n                }\n\n                // Disable developer tools.\n                if (settings.disabledevelopertools && settings.disabledevelopertools == true) {\n                    // Skip disabling if allowed in current page.\n                    if (settings.allowdevelopertools != '' && currentPage(url, settings.allowdevelopertools)) {\n                        return;\n                    }\n                    checkDevTools(root);\n                }\n            }\n\n            /**\n             * Check whether to show support modal or not. If yes then show.\n             * @param  {Boolean} showsupport True to show support modal\n             */\n            function support(showsupport) {\n                if (showsupport != true) {\n                    return;\n                }\n                ModalFactory.create({\n                    type: ModalFactory.types.DEFAULT,\n                    title: strings['supporttitle'],\n                    body: Templates.render('local_disablerightclick/support_modal', {})\n                }, $('#create-modal'))\n                .done(function(modal) {\n                    modal.getRoot();\n                    modal.show();\n                    $('body').on('click', '[data-action-disablerightclick]', function() {\n                        PROMISSES.SUPPORT($(this).data('value'));\n                        modal.destroy();\n                    });\n                })\n                .fail(Notification.exception);\n            }\n\n            $(document).ready(function() {\n                var contextid = 0;\n                if (M.cfg.contextid != undefined) {\n                    contextid = M.cfg.contextid;\n                }\n                PROMISSES.SETTINGS(contextid).done(function(response) {\n                    var data = JSON.parse(response);\n                    strings = data.strings;\n                    disabler($('body'), data.settings);\n                    support(data.showsupport, data.context);\n                    setInterval(function() {\n                        if ($('iframe').length == 0) {\n                            return;\n                        }\n                        $('iframe:not(.applied-disablement)').each(function(index, iframe) {\n                            $(this).addClass('applied-disablement');\n                            disabler($(iframe.contentWindow.document.body), data.settings);\n                        });\n                    }, 1000);\n                }).fail(Notification.exception);\n            });\n        }\n    };\n});\n"],"names":["define","$","Ajax","Notification","ModalFactory","ModalEvents","Templates","init","devtools","isOpen","orientation","undefined","strings","wholebody","wholehead","PROMISSES","contextid","call","methodname","args","action","showToaster","msg","duration","toast","append","addClass","setTimeout","removeClass","remove","devToolsToggled","console","clear","detach","length","developertoolsopened","currentPage","currentUrl","allowed","matched","trim","split","forEach","url","indexOf","disabler","root","settings","window","location","href","allowall","disablerightclick","allowrightclick","contextmenu","event","rightclick","preventDefault","disablecutcopypaste","allowcutcopypaste","on","ctrlKey","keyCode","cutcopypaste","disabledevelopertools","allowdevelopertools","shiftKey","developertools","setInterval","widthThreshold","outerWidth","innerWidth","heightThreshold","outerHeight","innerHeight","Firebug","chrome","isInitialized","checkDevTools","document","ready","M","cfg","done","response","showsupport","data","JSON","parse","context","create","type","types","DEFAULT","title","body","render","modal","getRoot","show","this","destroy","fail","exception","each","index","iframe","contentWindow"],"mappings":"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"}
=======
{"version":3,"sources":["../src/disabler.js"],"names":["define","$","Ajax","Notification","ModalFactory","ModalEvents","Templates","init","devtools","isOpen","orientation","threshold","strings","wholebody","wholehead","PROMISSES","SETTINGS","contextid","call","methodname","args","SUPPORT","action","showToaster","msg","duration","toast","append","addClass","setTimeout","removeClass","remove","devToolsToggled","console","clear","detach","length","developertoolsopened","checkDevTools","root","on","event","keyCode","ctrlKey","shiftKey","indexOf","developertools","preventDefault","setInterval","widthThreshold","window","outerWidth","innerWidth","heightThreshold","outerHeight","innerHeight","Firebug","chrome","isInitialized","currentPage","currentUrl","allowed","matched","trim","split","forEach","url","disabler","settings","location","href","allowall","disablerightclick","allowrightclick","contextmenu","rightclick","disablecutcopypaste","allowcutcopypaste","cutcopypaste","disableselection","allowselection","disabledevelopertools","allowdevelopertools","support","showsupport","create","type","types","DEFAULT","title","body","render","done","modal","getRoot","show","data","destroy","fail","exception","document","ready","M","cfg","response","JSON","parse","context","each","index","iframe","contentWindow"],"mappings":"AAyBAA,OAAM,oCAAC,CACH,QADG,CAEH,WAFG,CAGH,mBAHG,CAIH,oBAJG,CAKH,mBALG,CAMH,gBANG,CAAD,CAOH,SACCC,CADD,CAECC,CAFD,CAGCC,CAHD,CAICC,CAJD,CAKCC,CALD,CAMCC,CAND,CAOD,CACE,MAAO,CACHC,IAAI,CAAE,eAAW,IACTC,CAAAA,CAAQ,CAAG,CACXC,MAAM,GADK,CAEXC,WAAW,OAFA,CADF,CAOTC,CAAS,CAAG,GAPH,CAUTC,CAAO,CAAG,EAVD,CAaTC,CAAS,CAAG,IAbH,CAgBTC,CAAS,CAAG,IAhBH,CAmBTC,CAAS,CAAG,CACZC,QAAQ,CAAE,kBAAUC,CAAV,CAAqB,CAC3B,MAAOf,CAAAA,CAAI,CAACgB,IAAL,CAAU,CAAC,CACdC,UAAU,CAAE,kCADE,CAEdC,IAAI,CAAE,CACFH,SAAS,CAAEA,CADT,CAFQ,CAAD,CAAV,EAKH,CALG,CAMV,CARW,CASZI,OAAO,CAAE,iBAAUC,CAAV,CAAkB,CACvB,MAAOpB,CAAAA,CAAI,CAACgB,IAAL,CAAU,CAAC,CACdC,UAAU,CAAE,iCADE,CAEdC,IAAI,CAAE,CACFE,MAAM,CAAEA,CADN,CAFQ,CAAD,CAAV,EAKH,CALG,CAMV,CAhBW,CAnBH,CA4Cb,QAASC,CAAAA,CAAT,CAAqBC,CAArB,CAA0BC,CAA1B,CAAoC,CAChC,GAAIA,CAAQ,QAAZ,CAA2B,CACvBA,CAAQ,CAAG,GACd,CACD,GAAIC,CAAAA,CAAK,CAAGzB,CAAC,CAAC,kFAC0BuB,CAD1B,iBAAD,CAAb,CAGAvB,CAAC,CAAC,MAAD,CAAD,CAAU0B,MAAV,CAAiBD,CAAjB,EACAzB,CAAC,CAACyB,CAAD,CAAD,CAASE,QAAT,CAAkB,MAAlB,EACAC,UAAU,CAAC,UAAY,CACnB5B,CAAC,CAACyB,CAAD,CAAD,CAASE,QAAT,CAAkB,MAAlB,EACAC,UAAU,CAAC,UAAY,CACnB5B,CAAC,CAACyB,CAAD,CAAD,CAASI,WAAT,CAAqB,MAArB,EACAD,UAAU,CAAC,UAAY,CACnB5B,CAAC,CAACyB,CAAD,CAAD,CAASK,MAAT,EACH,CAFS,CAEP,GAFO,CAGb,CALS,CAKPN,CALO,CAMb,CARS,CASb,CAOD,QAASO,CAAAA,CAAT,CAAyBvB,CAAzB,CAAiC,CAC7B,GAAI,IAAAA,CAAJ,CAAoB,CAEhBwB,OAAO,CAACC,KAAR,GACArB,CAAS,CAAGZ,CAAC,CAAC,MAAD,CAAD,CAAUkC,MAAV,EAAZ,CACA,GAAIlC,CAAC,CAAC,MAAD,CAAL,CAAe,CACXa,CAAS,CAAGb,CAAC,CAAC,MAAD,CAAD,CAAUkC,MAAV,EACf,CACD,GAAsC,CAAlC,EAAAlC,CAAC,CAAC,oBAAD,CAAD,CAAwBmC,MAA5B,CAAyC,CACrCnC,CAAC,CAAC,MAAD,CAAD,CAAU0B,MAAV,CACI1B,CAAC,yeADL,CA4BH,CACDsB,CAAW,CAACX,CAAO,CAACyB,oBAAT,CAA+B,GAA/B,CACd,CACD,GAAI,IAAA5B,CAAJ,CAAqB,CACjBR,CAAC,CAAC,MAAD,CAAD,CAAU0B,MAAV,CAAiBd,CAAjB,EACAA,CAAS,CAAG,IAAZ,CACA,GAAkB,IAAd,GAAAC,CAAJ,CAAwB,CACpBb,CAAC,CAAC,MAAD,CAAD,CAAU0B,MAAV,CAAiBb,CAAjB,CACH,CACJ,CACJ,CAMD,QAASwB,CAAAA,CAAT,CAAuBC,CAAvB,CAA6B,CAGzBA,CAAI,CAACC,EAAL,CAAQ,SAAR,CAAmB,SAAUC,CAAV,CAAiB,CAChC,GAAqB,GAAjB,EAAAA,CAAK,CAACC,OAAN,EACC,IAAAD,CAAK,CAACE,OAAN,EAAyB,IAAAF,CAAK,CAACG,QAA/B,EAA0F,CAAC,CAAxC,GAAC,EAAD,CAAK,EAAL,CAAS,EAAT,EAAaC,OAAb,CAAqBJ,CAAK,CAACC,OAA3B,CADpD,EAEC,IAAAD,CAAK,CAACE,OAAN,EAAwD,CAAC,CAAhC,GAAC,EAAD,EAAKE,OAAL,CAAaJ,CAAK,CAACC,OAAnB,CAF9B,CAEkE,CAC9DnB,CAAW,CAACX,CAAO,CAACkC,cAAT,CAAX,CACAL,CAAK,CAACM,cAAN,EAEH,CACJ,CARD,EAWAC,WAAW,CAAC,UAAY,IAChBC,CAAAA,CAAc,CAAGC,MAAM,CAACC,UAAP,CAAoBD,MAAM,CAACE,UAA3B,CAAwCzC,CADzC,CAEhB0C,CAAe,CAAGH,MAAM,CAACI,WAAP,CAAqBJ,MAAM,CAACK,WAA5B,CAA0C5C,CAF5C,CAGhBD,CAAW,CAAGuC,CAAc,CAAG,UAAH,CAAgB,YAH5B,CAKpB,GACI,EAAEI,CAAe,EAAIJ,CAArB,IACEC,MAAM,CAACM,OAAP,EAAkBN,MAAM,CAACM,OAAP,CAAeC,MAAjC,EAA2CP,MAAM,CAACM,OAAP,CAAeC,MAAf,CAAsBC,aAAlE,EACGT,CADH,EAEGI,CAHJ,CADJ,CAKE,CACE,GAAI,CAAC7C,CAAQ,CAACC,MAAV,EAAoBD,CAAQ,CAACE,WAAT,GAAyBA,CAAjD,CAA8D,CAC1DsB,CAAe,IAClB,CAEDxB,CAAQ,CAACC,MAAT,IACAD,CAAQ,CAACE,WAAT,CAAuBA,CAC1B,CAZD,IAYO,CACH,GAAIF,CAAQ,CAACC,MAAb,CAAqB,CACjBuB,CAAe,IAClB,CAEDxB,CAAQ,CAACC,MAAT,IACAD,CAAQ,CAACE,WAAT,OACH,CACJ,CAzBU,CAyBR,GAzBQ,CA0Bd,CASD,QAASiD,CAAAA,CAAT,CAAqBC,CAArB,CAAiCC,CAAjC,CAA0C,CACtC,GAAIC,CAAAA,CAAO,GAAX,CACAD,CAAO,CAAGA,CAAO,CAACE,IAAR,GAAeC,KAAf,CAAqB,IAArB,CAAV,CACAH,CAAO,CAACI,OAAR,CAAgB,SAAUC,CAAV,CAAe,CAC3B,GAAIJ,CAAJ,CAAa,CACT,MACH,CACD,GAAsC,CAAC,CAAnC,EAAAF,CAAU,CAACf,OAAX,CAAmBqB,CAAG,CAACH,IAAJ,EAAnB,CAAJ,CAA0C,CACtCD,CAAO,GACV,CACJ,CAPD,EAQA,MAAOA,CAAAA,CACV,CAQD,QAASK,CAAAA,CAAT,CAAkB5B,CAAlB,CAAwB6B,CAAxB,CAAkC,CAG9B,GAAuB,CAAnB,EAAAA,CAAQ,CAAChC,MAAb,CAA0B,CACtB,MACH,CAGD,GAAI8B,CAAAA,CAAG,CAAGhB,MAAM,CAACmB,QAAP,CAAgBC,IAA1B,CAGA,GAAyB,EAArB,EAAAF,CAAQ,CAACG,QAAT,EAA2BZ,CAAW,CAACO,CAAD,CAAME,CAAQ,CAACG,QAAf,CAA1C,CAAoE,CAChE,MACH,CAGD,GAAIH,CAAQ,CAACI,iBAAT,EAA8B,IAAAJ,CAAQ,CAACI,iBAA3C,CAAsE,CAElE,GAAgC,EAA5B,EAAAJ,CAAQ,CAACK,eAAT,EAAkCd,CAAW,CAACO,CAAD,CAAME,CAAQ,CAACK,eAAf,CAAjD,CAAkF,CAC9E,MACH,CACDlC,CAAI,CAACmC,WAAL,CAAiB,SAAUjC,CAAV,CAAiB,CAC9BlB,CAAW,CAACX,CAAO,CAAC+D,UAAT,CAAX,CACAlC,CAAK,CAACM,cAAN,EAEH,CAJD,CAKH,CAGD,GAAIqB,CAAQ,CAACQ,mBAAT,EAAgC,IAAAR,CAAQ,CAACQ,mBAA7C,CAA0E,CAEtE,GAAkC,EAA9B,EAAAR,CAAQ,CAACS,iBAAT,EAAoClB,CAAW,CAACO,CAAD,CAAME,CAAQ,CAACS,iBAAf,CAAnD,CAAsF,CAClF,MACH,CACDtC,CAAI,CAACC,EAAL,CAAQ,SAAR,CAAmB,SAAUC,CAAV,CAAiB,CAChC,GAAI,IAAAA,CAAK,CAACE,OAAN,EAAwE,CAAC,CAAhD,GAAC,EAAD,CAAK,EAAL,CAAS,EAAT,CAAa,EAAb,CAAiB,EAAjB,EAAqBE,OAArB,CAA6BJ,CAAK,CAACC,OAAnC,CAA7B,CAAgF,CAC5EnB,CAAW,CAACX,CAAO,CAACkE,YAAT,CAAX,CACArC,CAAK,CAACM,cAAN,EAEH,CACJ,CAND,CAOH,CAED,GAAIqB,CAAQ,CAACW,gBAAT,EAA6B,IAAAX,CAAQ,CAACW,gBAA1C,CAAoE,CAEhE,GAA+B,EAA3B,EAAAX,CAAQ,CAACY,cAAT,EAAiCrB,CAAW,CAACO,CAAD,CAAME,CAAQ,CAACY,cAAf,CAAhD,CAAgF,CAC5E,MACH,CAED/E,CAAC,CAAC,MAAD,CAAD,CAAU2B,QAAV,CAAmB,gBAAnB,CACH,CAGD,GAAIwC,CAAQ,CAACa,qBAAT,EAAkC,IAAAb,CAAQ,CAACa,qBAA/C,CAA8E,CAE1E,GAAoC,EAAhC,EAAAb,CAAQ,CAACc,mBAAT,EAAsCvB,CAAW,CAACO,CAAD,CAAME,CAAQ,CAACc,mBAAf,CAArD,CAA0F,CACtF,MACH,CACD5C,CAAa,CAACC,CAAD,CAChB,CACJ,CAMD,QAAS4C,CAAAA,CAAT,CAAiBC,CAAjB,CAA8B,CAC1B,GAAI,IAAAA,CAAJ,CAAyB,CACrB,MACH,CACDhF,CAAY,CAACiF,MAAb,CAAoB,CAChBC,IAAI,CAAElF,CAAY,CAACmF,KAAb,CAAmBC,OADT,CAEhBC,KAAK,CAAE7E,CAAO,aAFE,CAGhB8E,IAAI,CAAEpF,CAAS,CAACqF,MAAV,CAAiB,uCAAjB,CAA0D,EAA1D,CAHU,CAApB,CAIG1F,CAAC,CAAC,eAAD,CAJJ,EAKK2F,IALL,CAKU,SAAUC,CAAV,CAAiB,CACnBA,CAAK,CAACC,OAAN,GACAD,CAAK,CAACE,IAAN,GACA9F,CAAC,CAAC,MAAD,CAAD,CAAUuC,EAAV,CAAa,OAAb,CAAsB,iCAAtB,CAAyD,UAAY,CACjEzB,CAAS,CAACM,OAAV,CAAkBpB,CAAC,CAAC,IAAD,CAAD,CAAQ+F,IAAR,CAAa,OAAb,CAAlB,EACAH,CAAK,CAACI,OAAN,EACH,CAHD,CAIH,CAZL,EAaKC,IAbL,CAaU/F,CAAY,CAACgG,SAbvB,CAcH,CAEDlG,CAAC,CAACmG,QAAD,CAAD,CAAYC,KAAZ,CAAkB,UAAW,CACzB,GAAIpF,CAAAA,CAAS,CAAG,CAAhB,CACA,GAAIqF,CAAC,CAACC,GAAF,CAAMtF,SAAN,QAAJ,CAAkC,CAC9BA,CAAS,CAAGqF,CAAC,CAACC,GAAF,CAAMtF,SACrB,CACDF,CAAS,CAACC,QAAV,CAAmBC,CAAnB,EAA8B2E,IAA9B,CAAmC,SAAUY,CAAV,CAAoB,CACnD,GAAIR,CAAAA,CAAI,CAAGS,IAAI,CAACC,KAAL,CAAWF,CAAX,CAAX,CACA5F,CAAO,CAAGoF,CAAI,CAACpF,OAAf,CACAuD,CAAQ,CAAClE,CAAC,CAAC,MAAD,CAAF,CAAY+F,CAAI,CAAC5B,QAAjB,CAAR,CACAe,CAAO,CAACa,CAAI,CAACZ,WAAN,CAAmBY,CAAI,CAACW,OAAxB,CAAP,CACA3D,WAAW,CAAC,UAAY,CACpB,GAA2B,CAAvB,GAAA/C,CAAC,CAAC,QAAD,CAAD,CAAYmC,MAAhB,CAA8B,CAC1B,MACH,CACDnC,CAAC,CAAC,kCAAD,CAAD,CAAsC2G,IAAtC,CAA2C,SAASC,CAAT,CAAgBC,CAAhB,CAAwB,CAC/D7G,CAAC,CAAC,IAAD,CAAD,CAAQ2B,QAAR,CAAiB,qBAAjB,EACAuC,CAAQ,CAAClE,CAAC,CAAC6G,CAAM,CAACC,aAAP,CAAqBX,QAArB,CAA8BV,IAA/B,CAAF,CAAwCM,CAAI,CAAC5B,QAA7C,CACX,CAHD,CAIH,CARU,CAQR,GARQ,CASd,CAdD,EAcG8B,IAdH,CAcQ/F,CAAY,CAACgG,SAdrB,CAeH,CApBD,CAqBH,CA3SE,CA6SV,CA5TK,CAAN","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript controller for disabling features like right click\n *\n * @module     local_disablerightclick/disabler\n * @package    local_disablerightclick\n * @copyright  2019 Yogesh Shirsath <yogshirsath@hotmail.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since      1.0\n */\n\ndefine([\n    'jquery',\n    'core/ajax',\n    'core/notification',\n    'core/modal_factory',\n    'core/modal_events',\n    'core/templates',\n], function (\n    $,\n    Ajax,\n    Notification,\n    ModalFactory,\n    ModalEvents,\n    Templates\n) {\n    return {\n        init: function() {\n            var devtools = {\n                isOpen: false,\n                orientation: undefined\n            };\n\n            // Threshold to check developer tools change.\n            var threshold = 160;\n\n            // Store strings.\n            var strings = [];\n\n            // Store whole body.\n            var wholebody = null;\n\n            // Store whole head.\n            var wholehead = null;\n\n            // Promises.\n            var PROMISSES = {\n                SETTINGS: function (contextid) {\n                    return Ajax.call([{\n                        methodname: \"local_disablerightclick_settings\",\n                        args: {\n                            contextid: contextid\n                        }\n                    }])[0];\n                },\n                SUPPORT: function (action) {\n                    return Ajax.call([{\n                        methodname: \"local_disablerightclick_support\",\n                        args: {\n                            action: action\n                        }\n                    }])[0];\n                }\n            };\n\n            /**\n             * Show toaster with message\n             *\n             * @param {String}  msg      Toaster message\n             * @param {Integer} duration Duration of toaster\n             */\n            function showToaster(msg, duration) {\n                if (duration == undefined) {\n                    duration = 2000;\n                }\n                var toast = $(\"<div class='disabler-toaster toaster-container'>\" +\n                    \"<lable class='toaster-message'>\" + msg + \"</lable>\" +\n                    \"</div>\");\n                $('html').append(toast);\n                $(toast).addClass('show');\n                setTimeout(function () {\n                    $(toast).addClass('fade');\n                    setTimeout(function () {\n                        $(toast).removeClass('fade');\n                        setTimeout(function () {\n                            $(toast).remove();\n                        }, 300);\n                    }, duration);\n                });\n            }\n\n            /**\n             * Start interval when developer tools is opened else clear inerval\n             *\n             * @param  {Boolean} isOpen true if tools is open\n             */\n            function devToolsToggled(isOpen) {\n                if (isOpen == true) {\n                    // eslint-disable-next-line no-console\n                    console.clear();\n                    wholebody = $('body').detach();\n                    if ($('head')) {\n                        wholehead = $('head').detach();\n                    }\n                    if ($('#body-detached-css').length == 0) {\n                        $('html').append(\n                            $('<style id=\"body-detached-css\">' +\n                                '.disabler-toaster.toaster-container {' +\n                                'position: fixed;' +\n                                'width: 100%;' +\n                                'top: 1vw;' +\n                                'z-index: 140002;' +\n                                'left: 0;' +\n                                'opacity: 0;' +\n                                'text-align: center;' +\n                                'transition: top 0.3s linear, opacity 0.3s linear;' +\n                                'display: none;' +\n                                '}' +\n                                '.disabler-toaster.toaster-container.fade {' +\n                                'top: 6vw;' +\n                                'opacity: 1;' +\n                                '}' +\n                                '.disabler-toaster.toaster-container.show {' +\n                                'display: block;' +\n                                '}' +\n                                '.disabler-toaster.toaster-container .toaster-message {' +\n                                'padding: 1rem 2rem;' +\n                                'color: white;' +\n                                'border-radius: 2px;' +\n                                'background-color: #424242;' +\n                                '}' +\n                                '</style>')\n                        );\n                    }\n                    showToaster(strings.developertoolsopened, 5000);\n                }\n                if (isOpen == false) {\n                    $('html').append(wholebody);\n                    wholebody = null;\n                    if (wholehead !== null) {\n                        $('html').append(wholehead);\n                    }\n                }\n            }\n\n            /**\n             * Check whether developer tools are opened or not\n             * @param {Object} root     root element object\n             */\n            function checkDevTools(root) {\n\n                // Check key down.\n                root.on('keydown', function (event) {\n                    if (event.keyCode == 123 ||\n                        (event.ctrlKey == true && event.shiftKey == true && [67, 73, 74].indexOf(event.keyCode) != -1) ||\n                        (event.ctrlKey == true && [85].indexOf(event.keyCode) != -1)) {\n                        showToaster(strings.developertools);\n                        event.preventDefault();\n                        return;\n                    }\n                });\n\n                // Start interval to check developer tools is open or close.\n                setInterval(function () {\n                    var widthThreshold = window.outerWidth - window.innerWidth > threshold;\n                    var heightThreshold = window.outerHeight - window.innerHeight > threshold;\n                    var orientation = widthThreshold ? 'vertical' : 'horizontal';\n\n                    if (\n                        !(heightThreshold && widthThreshold) &&\n                        ((window.Firebug && window.Firebug.chrome && window.Firebug.chrome.isInitialized) ||\n                            widthThreshold ||\n                            heightThreshold)\n                    ) {\n                        if (!devtools.isOpen || devtools.orientation !== orientation) {\n                            devToolsToggled(true);\n                        }\n\n                        devtools.isOpen = true;\n                        devtools.orientation = orientation;\n                    } else {\n                        if (devtools.isOpen) {\n                            devToolsToggled(false);\n                        }\n\n                        devtools.isOpen = false;\n                        devtools.orientation = undefined;\n                    }\n                }, 1000);\n            }\n\n            /**\n             * Check if current page has url from allowed list\n             *\n             * @param  {String} currentUrl Current page url\n             * @param  {String} allowed    Allowed url list\n             * @return {Bool} True if allowed on current page\n             */\n            function currentPage(currentUrl, allowed) {\n                var matched = false;\n                allowed = allowed.trim().split('\\n');\n                allowed.forEach(function (url) {\n                    if (matched) {\n                        return;\n                    }\n                    if (currentUrl.indexOf(url.trim()) != -1) {\n                        matched = true;\n                    }\n                });\n                return matched;\n            }\n\n            /**\n             * Disable functionality based on admin settings\n             *\n             * @param {Object} root     root element object\n             * @param {Object} settings Settings object\n             */\n            function disabler(root, settings) {\n\n                // Skip if no need to disable.\n                if (settings.length == 0) {\n                    return;\n                }\n\n                // Current page url.\n                var url = window.location.href;\n\n                // Skip disabling if all allowed in current page.\n                if (settings.allowall != '' && currentPage(url, settings.allowall)) {\n                    return;\n                }\n\n                // Disable right click.\n                if (settings.disablerightclick && settings.disablerightclick == true) {\n                    // Skip disabling if allowed in current page.\n                    if (settings.allowrightclick != '' && currentPage(url, settings.allowrightclick)) {\n                        return;\n                    }\n                    root.contextmenu(function (event) {\n                        showToaster(strings.rightclick);\n                        event.preventDefault();\n                        return;\n                    });\n                }\n\n                // Disable cut copy paste.\n                if (settings.disablecutcopypaste && settings.disablecutcopypaste == true) {\n                    // Skip disabling if allowed in current page.\n                    if (settings.allowcutcopypaste != '' && currentPage(url, settings.allowcutcopypaste)) {\n                        return;\n                    }\n                    root.on('keydown', function (event) {\n                        if (event.ctrlKey == true && [65, 67, 83, 86, 88].indexOf(event.keyCode) != -1) {\n                            showToaster(strings.cutcopypaste);\n                            event.preventDefault();\n                            return;\n                        }\n                    });\n                }\n\n                if (settings.disableselection && settings.disableselection == true) {\n                    // Skip disabling if allowed in current page.\n                    if (settings.allowselection != '' && currentPage(url, settings.allowselection)) {\n                        return;\n                    }\n\n                    $('body').addClass('prevent-select');\n                }\n\n                // Disable developer tools.\n                if (settings.disabledevelopertools && settings.disabledevelopertools == true) {\n                    // Skip disabling if allowed in current page.\n                    if (settings.allowdevelopertools != '' && currentPage(url, settings.allowdevelopertools)) {\n                        return;\n                    }\n                    checkDevTools(root);\n                }\n            }\n\n            /**\n             * Check whether to show support modal or not. If yes then show.\n             * @param  {Boolean} showsupport True to show support modal\n             */\n            function support(showsupport) {\n                if (showsupport != true) {\n                    return;\n                }\n                ModalFactory.create({\n                    type: ModalFactory.types.DEFAULT,\n                    title: strings['supporttitle'],\n                    body: Templates.render('local_disablerightclick/support_modal', {})\n                }, $('#create-modal'))\n                    .done(function (modal) {\n                        modal.getRoot();\n                        modal.show();\n                        $('body').on('click', '[data-action-disablerightclick]', function () {\n                            PROMISSES.SUPPORT($(this).data('value'));\n                            modal.destroy();\n                        });\n                    })\n                    .fail(Notification.exception);\n            }\n\n            $(document).ready(function() {\n                var contextid = 0;\n                if (M.cfg.contextid != undefined) {\n                    contextid = M.cfg.contextid;\n                }\n                PROMISSES.SETTINGS(contextid).done(function (response) {\n                    var data = JSON.parse(response);\n                    strings = data.strings;\n                    disabler($('body'), data.settings);\n                    support(data.showsupport, data.context);\n                    setInterval(function () {\n                        if ($('iframe').length === 0) {\n                            return;\n                        }\n                        $('iframe:not(.applied-disablement)').each(function(index, iframe) {\n                            $(this).addClass('applied-disablement');\n                            disabler($(iframe.contentWindow.document.body), data.settings);\n                        });\n                    }, 1000);\n                }).fail(Notification.exception);\n            });\n        }\n    };\n});\n"],"file":"disabler.min.js"}
>>>>>>> 30m1kff_disableselection
