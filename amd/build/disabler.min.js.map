{"version":3,"file":"disabler.min.js","sources":["../src/disabler.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript controller for disabling features like right click\n *\n * @module     local_disablerightclick/disabler\n * @copyright  2019 Yogesh Shirsath <yogshirsath@hotmail.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since      1.0\n */\n\ndefine([\n    'jquery',\n    'core/ajax',\n    'core/notification',\n    'core/log',\n], function (\n    $,\n    Ajax,\n    Notification,\n    Log\n) {\n    return {\n        init: function() {\n            var devtools = {\n                isOpen: false,\n                orientation: undefined\n            };\n\n            // Threshold to check developer tools change.\n            var threshold = 160;\n\n            // Store strings.\n            var strings = [];\n\n            // Store whole body.\n            var wholebody = null;\n\n            // Store whole head.\n            var wholehead = null;\n\n            // Promisses.\n            var PROMISSES = {\n                SETTINGS: function (contextid) {\n                    return Ajax.call([{\n                        methodname: \"local_disablerightclick_settings\",\n                        args: {\n                            contextid: contextid\n                        }\n                    }])[0];\n                }\n            };\n\n            /**\n             * Show toaster with message\n             *\n             * @param {String}  msg      Toaster message\n             * @param {Integer} duration Duration of toaster\n             */\n            function showToaster(msg, duration) {\n                if (duration === undefined) {\n                    duration = 2000;\n                }\n                let toast = $(\"<div class='disabler-toaster toaster-container'>\" +\n                    \"<lable class='toaster-message'>\" + msg + \" </lable>\" +\n                    \"</div>\");\n                $('html').append(toast);\n                $(toast).addClass('show');\n                setTimeout(function () {\n                    $(toast).addClass('fade');\n                    setTimeout(function () {\n                        $(toast).removeClass('fade');\n                        setTimeout(function () {\n                            $(toast).remove();\n                        }, 300);\n                    }, duration);\n                });\n            }\n\n            /**\n             * Start interval when developer tools is opened else clear inerval\n             *\n             * @param  {Boolean} isOpen true if tools is open\n             */\n            function devToolsToggled(isOpen) {\n                if (isOpen === true) {\n                    // eslint-disable-next-line no-console\n                    console.clear();\n                    wholebody = $('body').detach();\n                    if ($('head')) {\n                        wholehead = $('head').detach();\n                    }\n                    if ($('#body-detached-css').length == 0) {\n                        $('html').append(\n                            $('<style id=\"body-detached-css\">' +\n                                '.disabler-toaster.toaster-container {' +\n                                'position: fixed;' +\n                                'width: 100%;' +\n                                'top: 1vw;' +\n                                'z-index: 140002;' +\n                                'left: 0;' +\n                                'opacity: 0;' +\n                                'text-align: center;' +\n                                'transition: top 0.3s linear, opacity 0.3s linear;' +\n                                'display: none;' +\n                                '}' +\n                                '.disabler-toaster.toaster-container.fade {' +\n                                'top: 6vw;' +\n                                'opacity: 1;' +\n                                '}' +\n                                '.disabler-toaster.toaster-container.show {' +\n                                'display: block;' +\n                                '}' +\n                                '.disabler-toaster.toaster-container .toaster-message {' +\n                                'padding: 1rem 2rem;' +\n                                'color: white;' +\n                                'border-radius: 2px;' +\n                                'background-color: #424242;' +\n                                '}' +\n                                '</style>')\n                        );\n                    }\n                    showToaster(strings.developertoolsopened, 5000);\n                }\n                if (isOpen == false) {\n                    $('html').append(wholebody);\n                    wholebody = null;\n                    if (wholehead !== null) {\n                        $('html').append(wholehead);\n                    }\n                }\n            }\n\n            /**\n             * Check whether developer tools are opened or not\n             * @param {Object} root     root element object\n             */\n            function checkDevTools(root) {\n\n                // Check key down.\n                root.on('keydown', function (event) {\n                    if (event.keyCode == 123 ||\n                        (event.ctrlKey == true && event.shiftKey == true && [67, 73, 74].indexOf(event.keyCode) != -1) ||\n                        (event.ctrlKey == true && [85].indexOf(event.keyCode) != -1)) {\n                        showToaster(strings.developertools);\n                        event.preventDefault();\n                        return;\n                    }\n                });\n\n                // Start interval to check developer tools is open or close.\n                setInterval(function () {\n                    var widthThreshold = window.outerWidth - window.innerWidth > threshold;\n                    var heightThreshold = window.outerHeight - window.innerHeight > threshold;\n                    var orientation = widthThreshold ? 'vertical' : 'horizontal';\n\n                    if (\n                        !(heightThreshold && widthThreshold) &&\n                        ((window.Firebug && window.Firebug.chrome && window.Firebug.chrome.isInitialized) ||\n                            widthThreshold ||\n                            heightThreshold)\n                    ) {\n                        if (!devtools.isOpen || devtools.orientation !== orientation) {\n                            devToolsToggled(true);\n                        }\n\n                        devtools.isOpen = true;\n                        devtools.orientation = orientation;\n                    } else {\n                        if (devtools.isOpen) {\n                            devToolsToggled(false);\n                        }\n\n                        devtools.isOpen = false;\n                        devtools.orientation = undefined;\n                    }\n                }, 1000);\n            }\n\n            /**\n             * Check if current page has url from allowed list\n             *\n             * @param  {String} currentUrl Current page url\n             * @param  {String} allowed    Allowed url list\n             * @return {Bool} True if allowed on current page\n             */\n            function currentPage(currentUrl, allowed) {\n                var matched = false;\n                allowed = allowed.trim().split('\\n');\n                allowed.forEach(function (url) {\n                    if (matched) {\n                        return;\n                    }\n                    if (currentUrl.indexOf(url.trim()) != -1) {\n                        matched = true;\n                    }\n                });\n                return matched;\n            }\n\n            /**\n             * Disable functionality based on admin settings\n             *\n             * @param {Object} root     root element object\n             * @param {Object} settings Settings object\n             */\n            function disabler(root, settings) {\n\n                Log.log('disabler 1.0v');\n                // Skip if no need to disable.\n                if (settings.length == 0) {\n                    return;\n                }\n\n                // Current page url.\n                var url = window.location.href;\n\n                // Skip disabling if all allowed in current page.\n                if (settings.allowall != '' && currentPage(url, settings.allowall)) {\n                    return;\n                }\n\n                // Disable right click.\n                if (settings.disablerightclick && settings.disablerightclick == true) {\n                    // Skip disabling if allowed in current page.\n                    if (settings.allowrightclick != '' && currentPage(url, settings.allowrightclick)) {\n                        return;\n                    }\n                    root.contextmenu(function (event) {\n                        showToaster(strings.rightclick);\n                        event.preventDefault();\n                        return;\n                    });\n                }\n\n                // Disable cut copy paste.\n                if (settings.disablecutcopypaste && settings.disablecutcopypaste == true) {\n                    // Skip disabling if allowed in current page.\n                    if (settings.allowcutcopypaste != '' && currentPage(url, settings.allowcutcopypaste)) {\n                        return;\n                    }\n                    root.on('keydown', function (event) {\n                        if (event.ctrlKey == true && [65, 67, 83, 86, 88].indexOf(event.keyCode) != -1) {\n                            showToaster(strings.cutcopypaste);\n                            event.preventDefault();\n                            return;\n                        }\n                    });\n                }\n\n                if (settings.disableselection && settings.disableselection == true) {\n                    // Skip disabling if allowed in current page.\n                    if (settings.allowselection != '' && currentPage(url, settings.allowselection)) {\n                        return;\n                    }\n\n                    $('body').addClass('prevent-select');\n                }\n\n                // Disable developer tools.\n                if (settings.disabledevelopertools && settings.disabledevelopertools == true) {\n                    // Skip disabling if allowed in current page.\n                    if (settings.allowdevelopertools != '' && currentPage(url, settings.allowdevelopertools)) {\n                        return;\n                    }\n                    checkDevTools(root);\n                }\n            }\n\n            $(document).ready(function() {\n                let contextid = 0;\n                if (M.cfg.contextid != undefined) {\n                    contextid = M.cfg.contextid;\n                }\n                PROMISSES.SETTINGS(contextid).done(function (response) {\n                    var data = JSON.parse(response);\n                    strings = data.strings;\n                    disabler($('body'), data.settings);\n\n                    setInterval(function () {\n                        if ($('iframe').length === 0) {\n                            return;\n                        }\n                        $('iframe:not(.applied-disablement)').each(function(index, iframe) {\n                            $(this).addClass('applied-disablement');\n                            disabler($(iframe.contentWindow.document.body), data.settings);\n                        });\n                    }, 1000);\n                }).fail(Notification.exception);\n            });\n        }\n    };\n});\n"],"names":["define","$","Ajax","Notification","Log","init","devtools","isOpen","orientation","undefined","strings","wholebody","wholehead","PROMISSES","contextid","call","methodname","args","showToaster","msg","duration","toast","append","addClass","setTimeout","removeClass","remove","devToolsToggled","console","clear","detach","length","developertoolsopened","currentPage","currentUrl","allowed","matched","trim","split","forEach","url","indexOf","disabler","root","settings","log","window","location","href","allowall","disablerightclick","allowrightclick","contextmenu","event","rightclick","preventDefault","disablecutcopypaste","allowcutcopypaste","on","ctrlKey","keyCode","cutcopypaste","disableselection","allowselection","disabledevelopertools","allowdevelopertools","shiftKey","developertools","setInterval","widthThreshold","outerWidth","innerWidth","heightThreshold","outerHeight","innerHeight","Firebug","chrome","isInitialized","checkDevTools","document","ready","M","cfg","done","response","data","JSON","parse","each","index","iframe","this","contentWindow","body","fail","exception"],"mappings":"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"}